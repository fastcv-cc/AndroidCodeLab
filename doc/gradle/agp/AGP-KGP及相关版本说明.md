# AGP简介

Android Studio 构建系统以 Gradle 为基础，在Gradle的基础上，定制了针对Android 应用构建系统的Gradle插件，所以，全称为 Android Gradle plugin。

该系统支持编译多种不同类型的源代码，以及将其链接到可在实体 Android 设备或模拟器上运行的应用中。AGP 包含插件扩展点，用于控制 build 输入并通过可与标准 build 任务集成的新步骤扩展其功能。

典型 Android 应用模块的构建流程按照以下常规步骤执行：

- 编译器将源代码转换成 DEX 文件（Dalvik 可执行文件，其中包括在 Android 设备上运行的字节码），并将其他所有内容转换成编译后的资源。

- 打包器将 DEX 文件和编译后的资源组合成 APK 或 AAB（具体取决于所选的 build 目标）。 必须先为 APK 或 AAB 签名，然后才能将应用安装到 Android 设备或分发到 Google Play 等商店。

- 打包器使用调试或发布密钥库为 APK 或 AAB 签名。
  - 如果构建的是调试版应用（即专门用来测试和分析的应用），则打包器会使用调试密钥库为应用签名。Android Studio 会自动使用调试密钥库配置新项目。
  - 如果构建的是打算对外发布的发布版应用，则打包器会使用发布密钥库（需要进行配置）为应用签名。

- 在生成最终 APK 之前，打包器会使用 zipalign 工具对应用进行优化，以减少其在设备上运行时所占用的内存。

- 构建流程结束时，将获得应用的调试版或发布版 APK/AAB，以用于部署、测试或向外部用户发布。

  - APK（全称：Android application package，Android应用程序包）是Android操作系统使用的一种应用程序包文件格式，用于分发和安装移动应用及中间件。一个Android应用程序的代码想要在Android设备上运行，必须先进行编译，然后被打包成为一个被Android系统所能识别的文件才可以被运行，而这种能被Android系统识别并运行的文件格式便是“APK”。 一个APK文件内包含被编译的代码文件(.dex 文件)，文件资源（resources）， 原生资源文件（assets），证书（certificates），和清单文件（manifest file）

  - AAB（全称为Android App Bundles），谷歌应用商店的App格式。谷歌声称这种新格式将使应用程序文件更小，意味着aab分布式应用程序比通用apk平均少占用15% 的空间。更重要的是，它拓展了应用程序捆缚包的定义，只包含运行App时的必要代码。也就是说，下载了一部分之后，App就可以直接运行，无需等待下载完成再安装。



而AGP就是用来管理处理这个过程的工具，配置在我们的project根目录中的**build.gradle**文件中

```
buildscript {
    ...
    dependencies {
        classpath 'com.android.tools.build:gradle:7.4.2'
    }
}
```

然后在个项目中的**build.gradle**文件中使用

```
plugins {
    id 'com.android.application'
}
```





# KGP

同理，KGP就是专门针对kotlin的编写的Gradle插件。



# Gradle-AGP-KGP-Java-kotlin版本关系

## APG 与 Gradle 的版本关系

| 插件版本 | 所需的最低 Gradle 版本 |
| -------- | ---------------------- |
| 8.1      | 8.0                    |
| 8.0      | 8.0                    |
| 7.4      | 7.5                    |
| 7.3      | 7.4                    |
| 7.2      | 7.3.3                  |
| 7.1      | 7.2                    |
| 7.0      | 7.0                    |
| 4.2.0+   | 6.7.1                  |

| 4.1.0+        | 6.5+         |
| ------------- | ------------ |
| 4.0.0+        | 6.1.1+       |
| 3.6.0 - 3.6.4 | 5.6.4+       |
| 3.5.0 - 3.5.4 | 5.4.1+       |
| 3.4.0 - 3.4.3 | 5.1.1+       |
| 3.3.0 - 3.3.3 | 4.10.1+      |
| 3.2.0 - 3.2.1 | 4.6+         |
| 3.1.0+        | 4.4+         |
| 3.0.0+        | 4.1+         |
| 2.3.0+        | 3.3+         |
| 2.1.3 - 2.2.3 | 2.14.1 - 3.5 |
| 2.0.0 - 2.1.2 | 2.10 - 2.13  |
| 1.5.0         | 2.2.1 - 2.13 |
| 1.2.0 - 1.3.1 | 2.2.1 - 2.9  |
| 1.0.0 - 1.1.3 | 2.2.1 - 2.3  |



## AS与AGP的版本关系

| Android Studio 版本      | 所需插件版本 |
| ------------------------ | ------------ |
| Giraffe \| 2022.3.1      | 3.2-8.1      |
| Flamingo \| 2022.2.1     | 3.2-8.0      |
| Electric Eel \| 2022.1.1 | 3.2-7.4      |
| Dolphin \| 2021.3.1      | 3.2-7.3      |
| Chipmunk \| 2021.2.1     | 3.2-7.2      |
| Bumblebee \| 2021.1.1    | 3.2-7.1      |
| Arctic Fox \| 2020.3.1   | 3.1-7.0      |



## Java版本 与 Gradle版本的关系

| Java版本 | 第一个支持此版本的Gradle版本 |
| -------- | ---------------------------- |
| 8        | 2.0                          |
| 9        | 4.3                          |
| 10       | 4.7                          |
| 11       | 5.0                          |
| 12       | 5.4                          |
| 13       | 6.0                          |
| 14       | 6.3                          |
| 15       | 6.7                          |
| 16       | 7.0                          |
| 17       | 7.3                          |
| 18       | 7.5                          |
| 19       | 7.6                          |
| 20       | 8.1                          |



# AGP版本变更

## 7.0+

在最初的 **AGP4.2.0** 之后，AGP的版本直接就到了 AGP7.0 了，这样做的目的，官方的解释是:

我们将更新 Android Gradle 插件 (AGP) 的版本号，以使其更接近底层 Gradle 构建工具。

重要变更如下：

- AGP 现在将使用语义版本控制，并且重大变更将在主要版本中发布。
- 每年将发布一个 AGP 主要版本，与 Gradle 主要版本保持一致。
- AGP 4.2 之后的版本为版本 7.0，并且会要求升级到 Gradle 7.x 版。AGP 的每个主要版本都会要求在底层 Gradle 工具中进行主要版本升级。

![image.png](./assets/1700636241544-1468ef05-2600-4641-b4ec-ef718fa3fb7f.png)





